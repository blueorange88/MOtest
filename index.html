<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>시간 편집 테스트</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background: #0d1b2a; color: #fff; cursor: pointer; }
    td.time-cell { background: #f0f0f0; cursor: pointer; }
    .popup, .overlay {
      display: none;
      position: fixed;
      left: 0; top: 0; right: 0; bottom: 0;
      justify-content: center;
      align-items: center;
    }
    .overlay { background: rgba(0,0,0,0.5); z-index: 9; }
    .popup {
      z-index: 10; background: white; padding: 20px; border-radius: 8px;
      max-width: 300px; width: 90%; box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    .popup h3 { margin-bottom: 10px; }
    .popup label { display: block; margin: 10px 0; }
    .popup select, .popup input { width: 100%; padding: 5px; }
    .button-row { display: flex; justify-content: space-between; margin-top: 15px; }
    .button-row button { padding: 6px 12px; }
  </style>
</head>
<body>

<h2>시간 편집 테이블</h2>
<table id="schedule">
  <thead>
    <tr>
      <th id="headerTime">시간</th>
      <th>월</th>
      <th>화</th>
      <th>수</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- 팝업: 시간 범위 설정 -->
<div class="overlay" id="overlay"></div>
<div class="popup" id="popupRange">
  <h3>시간 범위 설정</h3>
  <label>시작 시각:
    <input type="time" id="rangeStart" value="06">
  </label>
  <label>종료 시각:
    <input type="time" id="rangeEnd" value="15">
  </label>
  <div class="button-row">
    <button onclick="applyTimeRange()">적용</button>
    <button onclick="closePopup()">취소</button>
  </div>
</div>

<!-- 팝업: 분 설정 -->
<div class="popup" id="popupMinute">
  <h3>분 선택</h3>
  <label>분 선택:
    <select id="minuteSelect">
      <option value="00">00</option>
      <option value="10">10</option>
      <option value="20">20</option>
      <option value="30">30</option>
      <option value="40">40</option>
      <option value="50">50</option>
    </select>
  </label>
  <div class="button-row">
    <button onclick="saveMinute()">저장</button>
    <button onclick="closePopup()">취소</button>
  </div>
</div>

<script>
  let currentTimeCell = null;

  // 페이지 로드시 기본 시간표 자동 생성
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('rangeStart').value = "06:00";
    document.getElementById('rangeEnd').value = "15:00";
    applyTimeRange();

    // '시간' 헤더 클릭 시 시간범위 팝업 열기
    document.getElementById('headerTime').onclick = () => {
      document.getElementById('popupRange').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    };
  });

  // 시간 범위 적용 함수
  function applyTimeRange() {
    const start = document.getElementById('rangeStart').value;
    const end = document.getElementById('rangeEnd').value;
    const tbody = document.querySelector('#schedule tbody');
    tbody.innerHTML = '';

    const startHour = parseInt(start.split(':')[0]);
    const endHour = parseInt(end.split(':')[0]);

    // 최소 3시간 이상만 허용
    if (endHour - startHour < 3) {
      alert("최소 3시간 이상설정가능 합니다.");
      return;
    }

    // 줄 생성
    for (let h = startHour; h < endHour; h++) {
      const tr = document.createElement('tr');
      const tdTime = document.createElement('td');
      tdTime.textContent = `${h}:00`;
      tdTime.className = 'time-cell';
      tdTime.onclick = () => openMinutePopup(tdTime); // 시간셀 누르면 분 팝업
      tr.appendChild(tdTime);
      for (let i = 0; i < 3; i++) {
        tr.appendChild(document.createElement('td'));
      }
      tbody.appendChild(tr);
    }
    closePopup();
  }

  // 분 설정 팝업 열기
  function openMinutePopup(td) {
    currentTimeCell = td;
    document.getElementById('popupMinute').style.display = 'flex';
    document.getElementById('overlay').style.display = 'block';
  }

  // 선택한 분 값 저장
  function saveMinute() {
    const min = document.getElementById('minuteSelect').value;
    const hour = currentTimeCell.textContent.split(':')[0];
    currentTimeCell.textContent = `${hour}:${min}`;
    closePopup();
  }

  // 팝업 닫기 공통
  function closePopup() {
    document.querySelectorAll('.popup').forEach(p => p.style.display = 'none');
    document.getElementById('overlay').style.display = 'none';
  }
</script>

</body>
</html>
